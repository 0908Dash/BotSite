<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSBot Panel</title>
  <link rel="stylesheet" href="panel.css">
</head>
<body>
  <button id="fullScreen" onclick="fullscreen()">
    <img src="https://www.svgrepo.com/show/103811/full-screen.svg" alt="Full Screen">
  </button>
  
  <h1>Main Panel</h1>

  <label class="switch">
    <input type="checkbox" id="dark-mode-toggle">
    <span class="slider round"></span>
  </label>

  <label class="menuButton">
    <span class="line1"><p>---</p></span>
    <span class="line2"><p>---</p></span>
    <span class="line3"><p>---</p></span>
  </label>

  <div class="nav">
    <a href="./addNew.html">Add New</a>
    <ul class="dirs">
      <li class="GolliCRAFT">
        <a href="./panels/GolliCRAFT/GolliCRAFT.html">GolliCRAFT</a>
        <ul class="dropdown">
          <li><a href="./panels/GolliCRAFT/ALLPanel.html">All Panel</a></li>
          <li><a href="./panels/GolliCRAFT/mainPanel.html">Main Panel</a></li>
          <li><a href="./panels/GolliCRAFT/musicPanel.html">Music Panel</a></li>
        </ul>
      </li>
      <li class="ClientServer">
        <a href="./panels/ClientServer/ClientServer.html">Client Server</a>
        <ul class="dropdown">
          <li><a href="./panels/ClientServer/ALLPanel.html">All Panel</a></li>
          <li><a href="./panels/ClientServer/mainPanel.html">Main Panel</a></li>
          <li><a href="./panels/ClientServer/musicPanel.html">Music Panel</a></li>
        </ul>
      </li>
      <li class="ToppedCRAFT">
        <a href="./panels/ToppedCRAFT/ToppedCRAFT.html">ToppedCRAFT</a>
        <ul class="dropdown">
          <li><a href="./panels/ToppedCRAFT/ALLPanel.html">All Panel</a></li>
          <li><a href="./panels/ToppedCRAFT/mainPanel.html">Main Panel</a></li>
          <li><a href="./panels/ToppedCRAFT/musicPanel.html">Music Panel</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <div class="console-container">
    <textarea id="console" rows="10" cols="50" readonly></textarea>
    <form id="console-form">
      <input type="text" id="console-input" placeholder="Input Here" autocomplete="on">
      <button type="button" id="console-submit-btn" class="rounded-btn">SEND</button>
    </form>
  </div>

  <div class="button-container">
    <ul>
      <li><button id="start-btn" class="rounded-btn">START ALL</button></li>
    </ul>
    <ul>
      <li><button id="stop-btn" class="rounded-btn stop-btn">STOP ALL</button></li>
    </ul>
    <ul>
      <li><button id="deploy-btn" class="rounded-btn deploy-btn">DEPLOY-COMMANDS</button></li>
    </ul>
    <ul>
      <li><button id="restart-btn" class="rounded-btn restart-btn">RESTART</button></li>
    </ul>
    <ul>
      <li><button id="delete-btn" class="rounded-btn delete-btn">DELETE-COMMANDS</button></li>
    </ul>

    <div class="stopwatch-container">
      <p id="stopwatch">00:00:00</p>
    </div>
  </div>
    
  </body>
  
  <script>
    // Function to format the current date and time as YYYY-MM-DD HH:mm:ss
  function getCurrentDateTime() {
    const now = new Date();
    const year = now.getFullYear();
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    const day = now.getDate().toString().padStart(2, '0');
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    const seconds = now.getSeconds().toString().padStart(2, '0');
    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
  }

  //-------------------------- Override Console Log Function
  const consoleTextarea = document.getElementById('console');

  console.log = function (message) {
    window.originalConsoleLog(message);
    const currentDateTime = getCurrentDateTime();
    consoleTextarea.value += `[${currentDateTime}] ${message}\n`;
  };

  window.originalConsoleLog = console.log;

//-------------------------- Dark Mode Toggle
const toggleSwitch = document.querySelector('#dark-mode-toggle');

function switchTheme(event) {
  console.log('Switching theme...'); // Add this line for debugging
  
  if (event.target.checked) {
    document.documentElement.setAttribute('data-theme', 'dark');
    localStorage.setItem('theme', 'dark');
    console.log('Dark Mode Active');
  } else {
    document.documentElement.setAttribute('data-theme', 'light');
    localStorage.setItem('theme', 'light');
    console.log('Light Mode Active')
  }
}

toggleSwitch.addEventListener('change', switchTheme, false);

const currentTheme = localStorage.getItem('theme') || 'light';

if (currentTheme) {
  document.documentElement.setAttribute('data-theme', currentTheme);

  if (currentTheme === 'dark') {
    toggleSwitch.checked = true;
  }
}
//-------------------------- Health Check
function performHealthCheck() {
  fetch('https://4x7xb1xb-1119.use2.devtunnels.ms/')
    .then(response => {
      if (response.ok) {
        console.log('Server is reachable');
      } else {
        console.error('Server is not reachable');
        displayMessage('Connection lost. Please check your internet connection.');
      }
    })
    .catch(error => {
      console.error('Error during health check:', error);
      displayMessage('Connection lost. Please check your internet connection.');
    });
}

function displayMessage(message) {
  console.log(message);
}

setInterval(performHealthCheck, 30000);
setTimeout(performHealthCheck, 2000);

setInterval(function () {
  displayMessage('Displaying a message every 30 minutes.');
}, 1800000);

//-----------------------------------------Input Processing function
const consoleInput = document.getElementById('console-input');
const consoleSubmitBtn = document.getElementById('console-submit-btn');

consoleSubmitBtn.addEventListener('click', function (event) {
  event.preventDefault(); // Prevent the default form submission behavior

  // Get the input value
  const userInput = consoleInput.value.trim();

  if (userInput !== '') {
    // Display the user input in the console
    console.log(`User Input: ${userInput}`);

    // Send the input to the server for processing
    processInputOnServer(userInput);

    // Clear the input field
    consoleInput.value = '';
  }
});

function processInputOnServer(input) {
  // Send an HTTP request to the server with the user input
  fetch('https://4x7xb1xb-1119.use2.devtunnels.ms/process-input', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      input: input,
    }),
  })
    .then(response => response.json())
    .then(data => {
      console.log(`Server Response: ${data.message}`);
    })
    .catch(error => {
      console.error('Error processing input on the server:', error);
    });
}

//-------------------------- Stopwatch Script
  let stopwatchInterval;
  let milliseconds = 0;
  let seconds = 0;
  let minutes = 0;
  let hours = 0;
  let days = 0;
  let months = 0;
  let years = 0;

  function startStopwatch() {
    stopwatchInterval = setInterval(updateStopwatch, 1); // Run every millisecond
  }

  function stopStopwatch() {
    clearInterval(stopwatchInterval);
  }

  function resetStopwatch() {
    clearInterval(stopwatchInterval);
    milliseconds = 0;
    seconds = 0;
    minutes = 0;
    hours = 0;
    days = 0;
    months = 0;
    years = 0;
    document.getElementById('stopwatch').innerText = '0:0:0';
  }

  function updateStopwatch() {
    milliseconds++;

    if (milliseconds === 1000) {
      milliseconds = 0;
      seconds++;

      if (seconds === 60) {
        seconds = 0;
        minutes++;

        if (minutes === 60) {
          minutes = 0;
          hours++;

          if (hours === 24) {
            hours = 0;
            days++;

            // Assuming 30 days in a month for simplicity
            if (days === 30) {
              days = 0;
              months++;

              if (months === 12) {
                months = 0;
                years++;
              }
            }
          }
        }
      }
    }

    const formattedTime = `${hours}:${minutes}:${seconds}`;
    document.getElementById('stopwatch').innerText = formattedTime;
  }

  function padNumber(num, size) {
    let str = num.toString();
    while (str.length < size) {
      str = '0' + str;
    }
    return str;
  }

  //-------------------------- Button Actions
  const startBtn = document.getElementById('start-btn');
  const stopBtn = document.getElementById('stop-btn');
  const deployBtn = document.getElementById('deploy-btn');
  const restartBtn = document.getElementById('restart-btn'); 
  const deleteBtn = document.getElementById('delete-btn');
  const fullScreen = document.getElementById('fullScreen');

  // Set initial display property for stop and restart buttons
  stopBtn.style.display = 'none';
  restartBtn.style.display = 'none';

  startBtn.addEventListener('click', () => {
    makeRequest('https://4x7xb1xb-1119.use2.devtunnels.ms/start-all');

    // Show the stop and restart buttons after starting the bot
    stopBtn.style.display = 'inline-block';
    restartBtn.style.display = 'inline-block';

    // Hide start, deploy, and delete buttons
    startBtn.style.display = 'none';
    deployBtn.style.display = 'none';
    deleteBtn.style.display = 'none';

    startStopwatch();
  });

  stopBtn.addEventListener('click', () => {
    makeRequest('https://4x7xb1xb-1119.use2.devtunnels.ms/stop-all');

    // Show the start, deploy, and delete buttons after stopping the bot
    startBtn.style.display = 'inline-block';
    deployBtn.style.display = 'inline-block';
    deleteBtn.style.display = 'inline-block';

    // Hide stop and restart buttons
    stopBtn.style.display = 'none';
    restartBtn.style.display = 'none';

    stopStopwatch();

    setTimeout(resetStopwatch(), 30000); //set delay 30 seconds (30000 milliseconds = 30 seconds)
  });

  deployBtn.addEventListener('click', () => {
    makeRequest('https://4x7xb1xb-1119.use2.devtunnels.ms/deploy-commands-all');
  });

  restartBtn.addEventListener('click', () => {
    makeRequest('https://4x7xb1xb-1119.use2.devtunnels.ms/restart-bot-all');

    stopStopwatch();
    resetStopwatch();

    setTimeout(startStopwatch, 1); //set 1 millisecond delay
  });

  deleteBtn.addEventListener('click', () => {
    makeRequest('https://4x7xb1xb-1119.use2.devtunnels.ms/delete-commands-all');
  });

  fullScreen.addEventListener('click', () => {
    /* Get the element you want displayed in fullscreen mode (the body in this case): */
var elem = document.body;

/* When the openFullscreen() function is executed, open the webpage in fullscreen. */
function openFullscreen() {
  if (elem.requestFullscreen) {
    elem.requestFullscreen();
  } else if (elem.webkitRequestFullscreen) { /* Safari */
    elem.webkitRequestFullscreen();
  } else if (elem.msRequestFullscreen) { /* IE11 */
    elem.msRequestFullscreen();
  }
}
  });
    
  function makeRequest(endpoint) {
    fetch(endpoint)
      .then(response => response.json())
      .then(data => {
        console.log(`Action completed: ${data.status}`);
      })
      .catch(error => {
        console.error(`Error executing action: ${error}`);
      });
  };
  //-------------------------------------------------------------- Module Exports
  module.exports = { consoleTextarea };
</script>
</html>
